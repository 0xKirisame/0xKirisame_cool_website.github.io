<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPiCa: Binary Star Systems & Kernel Sovereignty | 0xKirisame</title>
    <link rel="icon" href='../images/Tou.png'>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111111; color: #E5E5E5; }
        h1, h2, h3, h4 { font-family: 'Noto Serif JP', serif; color: white; margin-top: 1.5em; margin-bottom: 0.5em; }
        p { margin-bottom: 1.2em; line-height: 1.8; color: #d1d5db; }
        code { font-family: 'JetBrains Mono', monospace; background: #222; padding: 0.2em 0.4em; border-radius: 4px; color: #ff79c6; font-size: 0.9em; }
        pre { background: #1a1a1a; padding: 1.5em; border-radius: 8px; overflow-x: auto; border: 1px solid #333; margin-bottom: 2em; }
        pre code { background: transparent; padding: 0; color: #f8f8f2; }
        blockquote { border-left: 4px solid #ef4444; padding-left: 1em; color: #9ca3af; font-style: italic; margin-bottom: 1.5em; background: rgba(239, 68, 68, 0.05); padding: 1rem; border-radius: 0 8px 8px 0; }
        .diagram-box { border: 1px solid #333; padding: 1rem; border-radius: 8px; text-align: center; background: #1a1a1a; }
        .arrow-down { color: #666; font-size: 1.5rem; margin: 0.5rem 0; }
        /* Miku Colors */
        .text-miku { color: #39C5BB; }
        .border-miku { border-color: #39C5BB; }
        .bg-miku-dim { background-color: rgba(57, 197, 187, 0.1); }
        .shadow-miku { box-shadow: 0 0 30px rgba(57, 197, 187, 0.15); }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto max-w-3xl px-4 py-16">
        
        <nav class="mb-12 flex justify-between items-center text-sm text-gray-500">
            <a href="/blog/index.html" class="hover:text-white transition-colors">&larr; Return to Log</a>
            <span class="font-mono">LOG_ID: SPICA_V1</span>
        </nav>

        <header class="mb-12 border-b border-gray-800 pb-8">
            <h1 class="text-4xl md:text-5xl font-bold leading-tight mb-4">SPiCa: Binary Star Systems & Kernel Sovereignty</h1>
            <div class="flex items-center gap-4 mt-6">
                <img src="../images/Tou.png" class="w-12 h-12 rounded-full border border-gray-700">
                <div>
                    <div class="text-white font-medium">0xKirisame</div>
                    <div class="text-xs text-gray-500">Site Reliability Engineer • Rustacean</div>
                </div>
            </div>
        </header>

        <article class="prose prose-invert max-w-none">
            
            <p class="text-xl text-gray-300 font-serif italic border-l-2 border-miku pl-4 mb-12">
                "I'm going to sing, so shine bright, SPiCa..."
            </p>

            <div class="mb-12 rounded-lg overflow-hidden shadow-miku border border-gray-800 group">
                <img src="../images/spica_cover.png" alt="Hatsune Miku SPiCa" class="w-full object-cover opacity-80 group-hover:opacity-100 transition-opacity duration-500">
            </div>

            <div class="text-justify space-y-6">
                <p>
                    A few weeks ago, I was playing <em>Hatsune Miku Project Diva 2nd F</em> on my PS Vita. I was grinding the song <strong>"SPiCa -39's Giving Day Edition-"</strong>, and something about the lyrics made me curious. I paused the game and looked it up.
                </p>

                <p>
                    I discovered that Spica isn't just a name. It’s the brightest star in the Virgo constellation and a binary star system. It’s not one massive star, but two distinct stars spinning in perfect harmony, so close together that they appear as one single, brilliant point of light in the night sky.
                </p>

                <p>
                    That explanation immediately painted an image in my mind: <strong>The Kernel and The User Space.</strong>
                </p>

                <p>
                    Ideally, they are like binary stars spinning in harmony, perfectly synchronized, always understanding each other. But then it hit me: <em>Do they always spin in harmony?</em>
                </p>

                <p>
                    No. Rootkits exist. They poison the relationship. They decouple the reality of the Kernel from the perception of the User. They ruin the harmony.
                </p>

                <p>
                    That’s when I realized that my idea for a rootkit detector based on differential analysis was actually the engineering equivalent of that binary star system. I looked at existing tools, mostly built on LKMs (Loadable Kernel Modules) and C++. They were powerful, sure, but unstable. A bug there bricks your kernel.
                </p>

                <p>
                    What does the world need now? A detector that is stable, safe, and fast. That is why I wrote <strong>SPiCa</strong> in Rust using the Aya eBPF stack.
                </p>
            </div>

            <hr class="border-gray-800 my-12">

            <h2>Live Demonstration</h2>
            <p>
                Seeing is believing. Below is a recording of SPiCa catching <strong>Nysm</strong>, a modern stealth container that uses eBPF to blind standard tools like <code>ps</code> and <code>top</code>. Note the delay: Nysm activates its cloak, but SPiCa sees through it instantly.
            </p>

            <div class="my-8 border border-gray-700 rounded-lg overflow-hidden bg-black shadow-miku">
                <div class="bg-gray-900 px-4 py-2 border-b border-gray-800 flex items-center justify-between">
                    <span class="text-xs font-mono text-miku">root@kirisame:~# ./spica_demo.mp4</span>
                    <div class="flex gap-2">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    </div>
                </div>
                <video controls class="w-full">
                    <source src="../images/nysm_kill.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            <h2>SPiCa: System Process Integrity & Cross-view Analysis</h2>

            <p class="text-justify">
                SPiCa is a high-performance, eBPF-based rootkit detection engine. Inspired by the miku song by toku, SPiCa acts as that "Binary Star" enforcing <strong>Kernel Sovereignty</strong> by establishing a ground truth based on CPU execution rather than relying on potentially compromised system APIs.
            </p>

            <div class="bg-gray-900 rounded-lg p-6 border border-gray-800 my-8">
                <h3 class="!mt-0 text-lg font-bold text-gray-200 mb-4">The "Layer 0" Argument</h3>
                <p class="text-sm text-justify">
                    Some people argue that SPiCa is only effective in Layer 0 (Kernel) and is irrelevant in the cloud age. I argue the opposite.
                </p>
                <p class="text-sm mb-0 text-justify">
                    In the Cloud Shared Responsibility Model, everything above Layer 0 is the user's problem. While the provider handles the hypervisor and firmware, the <strong>guest kernel</strong> is your territory. If an attacker owns your kernel, they own your data. SPiCa defends that sovereignty.
                </p>
            </div>

            <h3>The Architecture</h3>
            <p>
                SPiCa operates on a "Binary Star" principle, maintaining two distinct observational vantages to identify discrepancies in system state:
            </p>

            <div class="grid md:grid-cols-2 gap-8 my-10">
                <div class="bg-miku-dim border border-miku rounded-lg p-6">
                    <h4 class="!mt-0 text-miku font-bold">1. The Kernel View</h4>
                    <p class="text-sm text-gray-300">
                        <strong>Ground Truth.</strong> Utilizes an eBPF probe hooked into the <code>sched_switch</code> tracepoint. This captures the raw execution context of every process the moment it touches the CPU, bypassing the Virtual File System (VFS).
                    </p>
                </div>
                <div class="bg-[#1a1a1a] border border-gray-700 rounded-lg p-6">
                    <h4 class="!mt-0 text-blue-400 font-bold">2. The User View</h4>
                    <p class="text-sm text-gray-300">
                        <strong>Reported Reality.</strong> Queries standard system APIs (like the <code>/proc</code> filesystem) to retrieve the list of processes the Operating System <em>claims</em> are running.
                    </p>
                </div>
            </div>

            <div class="my-12 p-8 bg-[#0a0a0a] rounded-xl border border-gray-800">
                <h4 class="text-center text-gray-500 text-sm tracking-widest mb-8">THE DIFFERENTIAL ENGINE</h4>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="diagram-box border-miku text-miku">
                        Process Scheduled<br><span class="text-xs text-gray-500">(sched_switch)</span>
                    </div>
                    <div class="diagram-box border-blue-500 text-blue-400">
                        User Query<br><span class="text-xs text-gray-500">(/proc scan)</span>
                    </div>
                </div>

                <div class="text-center text-2xl text-gray-600 my-2">↓↓</div>

                <div class="diagram-box border-yellow-500 text-yellow-400 max-w-md mx-auto">
                    <strong>Differential Analysis</strong><br>
                    <span class="text-xs text-gray-400">Comparing Physical Reality vs Reported Reality</span>
                </div>

                <div class="flex justify-center gap-16 mt-4">
                    <div class="text-center">
                        <div class="text-gray-600 mb-2">Match</div>
                        <span class="inline-block px-3 py-1 bg-green-900 text-green-300 text-xs rounded">CLEAN</span>
                    </div>
                    <div class="text-center">
                        <div class="text-gray-600 mb-2">Mismatch</div>
                        <span class="inline-block px-3 py-1 bg-red-900 text-red-300 text-xs rounded animate-pulse">ANOMALY</span>
                    </div>
                </div>
            </div>

            <h3>Detection Logic</h3>
            <div class="mb-8"></div> <ul class="list-none pl-0 space-y-4">
                <li class="flex gap-4">
                    <span class="text-green-500 font-mono font-bold">CLEAN</span>
                    <span class="text-gray-400">The process executes on the CPU and is correctly reported by the OS. Harmony.</span>
                </li>
                <li class="flex gap-4">
                    <span class="text-yellow-500 font-mono font-bold">SUSPECT</span>
                    <span class="text-gray-400">A transient state. The process is in the kernel but missing from User space. We debounce this to filter out race conditions.</span>
                </li>
                <li class="flex gap-4">
                    <span class="text-red-500 font-mono font-bold">GHOST</span>
                    <span class="text-gray-400"><strong>DKOM Detected.</strong> A process is consuming CPU cycles but is persistently invisible to tools like <code>ps</code> or <code>top</code>. This is a rootkit.</span>
                </li>
                <li class="flex gap-4">
                    <span class="text-purple-500 font-mono font-bold">MASQUERADE</span>
                    <span class="text-gray-400"><strong>PID Hollowing.</strong> The process name recorded by the Scheduler differs from the name reported by the filesystem.</span>
                </li>
            </ul>

            <blockquote class="text-sm mt-8 border-yellow-500 bg-yellow-900/10">
                <strong>⚠️ DEV NOTE:</strong> Masquerade Detection (PID Hollowing) is currently under active construction. The hooks are in place, but the userspace logic is landing in v1.2.
            </blockquote>

            <div class="mb-8"></div> <h3>Technology Stack</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-sm font-mono mt-6">
                <div class="bg-gray-800 p-2 rounded text-orange-400">Rust</div>
                <div class="bg-gray-800 p-2 rounded text-blue-400">Aya (eBPF)</div>
                <div class="bg-gray-800 p-2 rounded text-green-400">Tokio</div>
                <div class="bg-gray-800 p-2 rounded text-purple-400">sched_switch</div>
            </div>

            <hr class="border-gray-800 my-12">

            <footer class="text-gray-500 text-sm flex justify-between items-center">
                <div>
                    <p class="mb-1">Build Instructions & Source Code:</p>
                    <a href="https://github.com/0xKirisame/SPiCa" class="text-miku hover:underline font-bold">github.com/0xKirisame/SPiCa</a>
                </div>
                <div class="text-right">
                    License: GPL-2.0<br>
                    <em>Shine bright.</em>
                </div>
            </footer>

        </article>
    </div>
</body>
</html>
